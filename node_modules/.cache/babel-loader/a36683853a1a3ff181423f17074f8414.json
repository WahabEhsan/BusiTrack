{"ast":null,"code":"\"use strict\";\n/**\r\n * implements https://w3c.github.io/accname/\r\n */\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst getRole_1 = __importDefault(require(\"./getRole\"));\n\nconst util_1 = require(\"./util\");\n/**\r\n * Small utility that handles all the JS quirks with `this` which is important\r\n * if no mock is provided.\r\n * @param element\r\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\r\n */\n\n\nfunction createGetComputedStyle(element, options) {\n  const window = util_1.safeWindow(element);\n  const {\n    // This might be overengineered. I don't know what happens if I call\n    // window.getComputedStyle(elementFromAnotherWindow) or if I don't bind it\n    // the type declarations don't require a `this`\n    getComputedStyle = window.getComputedStyle.bind(window)\n  } = options;\n  return getComputedStyle;\n}\n/**\r\n *\r\n * @param {string} string -\r\n * @returns {FlatString} -\r\n */\n\n\nfunction asFlatString(s) {\n  return s.trim().replace(/\\s\\s+/g, \" \");\n}\n/**\r\n * https://w3c.github.io/aria/#namefromprohibited\r\n */\n\n\nfunction prohibitsNaming(node) {\n  return hasAnyConcreteRoles(node, [\"caption\", \"code\", \"deletion\", \"emphasis\", \"generic\", \"insertion\", \"paragraph\", \"presentation\", \"strong\", \"subscript\", \"superscript\"]);\n}\n/**\r\n *\r\n * @param node -\r\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\r\n * @returns {boolean} -\r\n */\n\n\nfunction isHidden(node, options) {\n  if (!util_1.isElement(node)) {\n    return false;\n  }\n\n  if (node.hasAttribute(\"hidden\") || node.getAttribute(\"aria-hidden\") === \"true\") {\n    return true;\n  }\n\n  const style = createGetComputedStyle(node, options)(node);\n  return style.getPropertyValue(\"display\") === \"none\" || style.getPropertyValue(\"visibility\") === \"hidden\";\n}\n/**\r\n *\r\n * @param {Node} node -\r\n * @param {string} attributeName -\r\n * @returns {Element[]} -\r\n */\n\n\nfunction idRefs(node, attributeName) {\n  if (util_1.isElement(node) && node.hasAttribute(attributeName)) {\n    // safe due to hasAttribute check\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const ids = node.getAttribute(attributeName).split(\" \");\n    return ids // safe since it can't be null for an Element\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    .map(id => node.ownerDocument.getElementById(id)).filter(element => element !== null // TODO: why does this not narrow?\n    );\n  }\n\n  return [];\n}\n/**\r\n * All defined children. This include childNodes as well as owned (portaled) trees\r\n * via aria-owns\r\n * @param node\r\n */\n\n\nfunction queryChildNodes(node) {\n  return Array.from(node.childNodes).concat(idRefs(node, \"aria-owns\"));\n}\n/**\r\n * @param {Node} node -\r\n * @returns {boolean} - As defined in step 2E of https://w3c.github.io/accname/#mapping_additional_nd_te\r\n */\n\n\nfunction isControl(node) {\n  return hasAnyConcreteRoles(node, [\"button\", \"combobox\", \"listbox\", \"textbox\"]) || hasAbstractRole(node, \"range\");\n}\n\nfunction hasAbstractRole(node, role) {\n  if (!util_1.isElement(node)) {\n    return false;\n  }\n\n  switch (role) {\n    case \"range\":\n      return hasAnyConcreteRoles(node, [\"meter\", \"progressbar\", \"scrollbar\", \"slider\", \"spinbutton\"]);\n\n    default:\n      throw new TypeError(`No knowledge about abstract role '${role}'. This is likely a bug :(`);\n  }\n}\n\nfunction hasAnyConcreteRoles(node, roles) {\n  if (util_1.isElement(node)) {\n    return roles.indexOf(getRole_1.default(node)) !== -1;\n  }\n\n  return false;\n}\n/**\r\n * element.querySelectorAll but also considers owned tree\r\n * @param element\r\n * @param selectors\r\n */\n\n\nfunction querySelectorAllSubtree(element, selectors) {\n  const elements = [];\n\n  for (const root of [element, ...idRefs(element, \"aria-owns\")]) {\n    elements.push(...Array.from(root.querySelectorAll(selectors)));\n  }\n\n  return elements;\n}\n\nfunction querySelectedOptions(listbox) {\n  if (util_1.isHTMLSelectElement(listbox)) {\n    // IE11 polyfill\n    return listbox.selectedOptions || querySelectorAllSubtree(listbox, \"[selected]\");\n  }\n\n  return querySelectorAllSubtree(listbox, '[aria-selected=\"true\"]');\n}\n\nfunction isMarkedPresentational(node) {\n  return hasAnyConcreteRoles(node, [\"none\", \"presentation\"]);\n}\n/**\r\n * TODO\r\n */\n\n\nfunction isNativeHostLanguageTextAlternativeElement(node) {\n  return false;\n}\n/**\r\n * https://w3c.github.io/aria/#namefromcontent\r\n */\n\n\nfunction allowsNameFromContent(node) {\n  return hasAnyConcreteRoles(node, [\"button\", \"cell\", \"checkbox\", \"columnheader\", \"gridcell\", \"heading\", \"label\", \"legend\", \"link\", \"menuitem\", \"menuitemcheckbox\", \"menuitemradio\", \"option\", \"radio\", \"row\", \"rowheader\", \"switch\", \"tab\", \"tooltip\", \"treeitem\"]);\n}\n/**\r\n * TODO\r\n */\n\n\nfunction isDescendantOfNativeHostLanguageTextAlternativeElement(node) {\n  return false;\n}\n/**\r\n * TODO\r\n */\n\n\nfunction computeTooltipAttributeValue(node) {\n  return null;\n}\n\nfunction getValueOfTextbox(element) {\n  if (util_1.isHTMLInputElement(element) || util_1.isHTMLTextAreaElement(element)) {\n    return element.value;\n  } // https://github.com/eps1lon/dom-accessibility-api/issues/4\n\n\n  return element.textContent || \"\";\n}\n\nfunction getTextualContent(declaration) {\n  const content = declaration.getPropertyValue(\"content\");\n\n  if (/^[\"'].*[\"']$/.test(content)) {\n    return content.slice(1, -1);\n  }\n\n  return \"\";\n}\n/**\r\n * implements https://w3c.github.io/accname/#mapping_additional_nd_te\r\n * @param root\r\n * @param [options]\r\n * @parma [options.getComputedStyle] - mock window.getComputedStyle. Needs `content`, `display` and `visibility`\r\n */\n\n\nfunction computeAccessibleName(root, options = {}) {\n  const consultedNodes = new Set();\n\n  if (prohibitsNaming(root)) {\n    return \"\";\n  } // 2F.i\n\n\n  function computeMiscTextAlternative(node, context) {\n    let accumulatedText = \"\";\n\n    if (util_1.isElement(node)) {\n      const pseudoBefore = createGetComputedStyle(node, options)(node, \"::before\");\n      const beforeContent = getTextualContent(pseudoBefore);\n      accumulatedText = `${beforeContent} ${accumulatedText}`;\n    }\n\n    for (const child of queryChildNodes(node)) {\n      const result = computeTextAlternative(child, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: false,\n        recursion: true\n      }); // TODO: Unclear why display affects delimiter\n\n      const display = util_1.isElement(node) && createGetComputedStyle(node, options)(node).getPropertyValue(\"display\");\n      const separator = display !== \"inline\" ? \" \" : \"\";\n      accumulatedText += `${separator}${result}`;\n    }\n\n    if (util_1.isElement(node)) {\n      const pseudoAfter = createGetComputedStyle(node, options)(node, \":after\");\n      const afterContent = getTextualContent(pseudoAfter);\n      accumulatedText = `${accumulatedText} ${afterContent}`;\n    }\n\n    return accumulatedText;\n  }\n  /**\r\n   * TODO: placeholder\r\n   */\n\n\n  function computeAttributeTextAlternative(node) {\n    if (!util_1.isElement(node)) {\n      return null;\n    }\n\n    const titleAttribute = node.getAttributeNode(\"title\");\n\n    if (titleAttribute !== null && !consultedNodes.has(titleAttribute)) {\n      consultedNodes.add(titleAttribute);\n      return titleAttribute.value;\n    }\n\n    const altAttribute = node.getAttributeNode(\"alt\");\n\n    if (altAttribute !== null && !consultedNodes.has(altAttribute)) {\n      consultedNodes.add(altAttribute);\n      return altAttribute.value;\n    }\n\n    if (util_1.isHTMLInputElement(node) && node.type === \"button\") {\n      consultedNodes.add(node);\n      return node.getAttribute(\"value\") || \"\";\n    }\n\n    return null;\n  }\n\n  function computeElementTextAlternative(node) {\n    if (!util_1.isHTMLInputElement(node)) {\n      return null;\n    }\n\n    const input = node; // https://w3c.github.io/html-aam/#input-type-text-input-type-password-input-type-search-input-type-tel-input-type-email-input-type-url-and-textarea-element-accessible-description-computation\n\n    if (input.type === \"submit\") {\n      return \"Submit\";\n    }\n\n    if (input.type === \"reset\") {\n      return \"Reset\";\n    }\n\n    const {\n      labels\n    } = input; // IE11 does not implement labels, TODO: verify with caniuse instead of mdn\n\n    if (labels === null || labels === undefined || labels.length === 0) {\n      return null;\n    }\n\n    consultedNodes.add(input);\n    return Array.from(labels).map(element => {\n      return computeTextAlternative(element, {\n        isEmbeddedInLabel: true,\n        isReferenced: false,\n        recursion: true\n      });\n    }).filter(label => {\n      return label.length > 0;\n    }).join(\" \");\n  }\n\n  function computeTextAlternative(current, context) {\n    if (consultedNodes.has(current)) {\n      return \"\";\n    } // special casing, cheating to make tests pass\n    // https://github.com/w3c/accname/issues/67\n\n\n    if (hasAnyConcreteRoles(current, [\"menu\"])) {\n      consultedNodes.add(current);\n      return \"\";\n    } // 2A\n\n\n    if (isHidden(current, options) && !context.isReferenced) {\n      consultedNodes.add(current);\n      return \"\";\n    } // 2B\n\n\n    const labelElements = idRefs(current, \"aria-labelledby\");\n\n    if (!context.isReferenced && labelElements.length > 0) {\n      return labelElements.map(element => computeTextAlternative(element, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: true,\n        // thais isn't recursion as specified, otherwise we would skip\n        // `aria-label` in\n        // <input id=\"myself\" aria-label=\"foo\" aria-labelledby=\"myself\"\n        recursion: false\n      })).join(\" \");\n    } // 2C\n    // Changed from the spec in anticipation of https://github.com/w3c/accname/issues/64\n    // spec says we should only consider skipping if we have a non-empty label\n\n\n    const skipToStep2E = context.recursion && isControl(current);\n\n    if (!skipToStep2E) {\n      const ariaLabel = (util_1.isElement(current) && current.getAttribute(\"aria-label\") || \"\").trim();\n\n      if (ariaLabel !== \"\") {\n        consultedNodes.add(current);\n        return ariaLabel;\n      } // 2D\n\n\n      if (!isMarkedPresentational(current)) {\n        const elementTextAlternative = computeElementTextAlternative(current);\n\n        if (elementTextAlternative !== null) {\n          consultedNodes.add(current);\n          return elementTextAlternative;\n        }\n\n        const attributeTextAlternative = computeAttributeTextAlternative(current);\n\n        if (attributeTextAlternative !== null) {\n          consultedNodes.add(current);\n          return attributeTextAlternative;\n        }\n      }\n    } // 2E\n\n\n    if (skipToStep2E || context.isEmbeddedInLabel || context.isReferenced) {\n      if (hasAnyConcreteRoles(current, [\"combobox\", \"listbox\"])) {\n        consultedNodes.add(current);\n        const selectedOptions = querySelectedOptions(current);\n\n        if (selectedOptions.length === 0) {\n          // defined per test `name_heading_combobox`\n          return util_1.isHTMLInputElement(current) ? current.value : \"\";\n        }\n\n        return Array.from(selectedOptions).map(selectedOption => {\n          return computeTextAlternative(selectedOption, {\n            isEmbeddedInLabel: context.isEmbeddedInLabel,\n            isReferenced: false,\n            recursion: true\n          });\n        }).join(\" \");\n      }\n\n      if (hasAbstractRole(current, \"range\")) {\n        consultedNodes.add(current);\n\n        if (current.hasAttribute(\"aria-valuetext\")) {\n          // safe due to hasAttribute guard\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return current.getAttribute(\"aria-valuetext\");\n        }\n\n        if (current.hasAttribute(\"aria-valuenow\")) {\n          // safe due to hasAttribute guard\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return current.getAttribute(\"aria-valuenow\");\n        } // Otherwise, use the value as specified by a host language attribute.\n\n\n        return current.getAttribute(\"value\") || \"\";\n      }\n\n      if (hasAnyConcreteRoles(current, [\"textbox\"])) {\n        consultedNodes.add(current);\n        return getValueOfTextbox(current);\n      }\n    } // 2F: https://w3c.github.io/accname/#step2F\n\n\n    if (allowsNameFromContent(current) || util_1.isElement(current) && context.isReferenced || isNativeHostLanguageTextAlternativeElement(current) || isDescendantOfNativeHostLanguageTextAlternativeElement(current)) {\n      consultedNodes.add(current);\n      return computeMiscTextAlternative(current, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: false\n      });\n    }\n\n    if (current.nodeType === current.TEXT_NODE) {\n      consultedNodes.add(current);\n      return current.textContent || \"\";\n    }\n\n    if (context.recursion) {\n      consultedNodes.add(current);\n      return computeMiscTextAlternative(current, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: false\n      });\n    }\n\n    const tooltipAttributeValue = computeTooltipAttributeValue(current);\n\n    if (tooltipAttributeValue !== null) {\n      consultedNodes.add(current);\n      return tooltipAttributeValue;\n    } // TODO should this be reachable?\n\n\n    consultedNodes.add(current);\n    return \"\";\n  }\n\n  return asFlatString(computeTextAlternative(root, {\n    isEmbeddedInLabel: false,\n    isReferenced: false,\n    recursion: false\n  }));\n}\n\nexports.computeAccessibleName = computeAccessibleName;","map":{"version":3,"sources":["../sources/accessible-name.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\n/**\r\n * implements https://w3c.github.io/accname/\r\n */\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst getRole_1 = __importDefault(require(\"./getRole\"));\r\nconst util_1 = require(\"./util\");\r\n/**\r\n * Small utility that handles all the JS quirks with `this` which is important\r\n * if no mock is provided.\r\n * @param element\r\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\r\n */\r\nfunction createGetComputedStyle(element, options) {\r\n    const window = util_1.safeWindow(element);\r\n    const { \r\n    // This might be overengineered. I don't know what happens if I call\r\n    // window.getComputedStyle(elementFromAnotherWindow) or if I don't bind it\r\n    // the type declarations don't require a `this`\r\n    getComputedStyle = window.getComputedStyle.bind(window) } = options;\r\n    return getComputedStyle;\r\n}\r\n/**\r\n *\r\n * @param {string} string -\r\n * @returns {FlatString} -\r\n */\r\nfunction asFlatString(s) {\r\n    return s.trim().replace(/\\s\\s+/g, \" \");\r\n}\r\n/**\r\n * https://w3c.github.io/aria/#namefromprohibited\r\n */\r\nfunction prohibitsNaming(node) {\r\n    return hasAnyConcreteRoles(node, [\r\n        \"caption\",\r\n        \"code\",\r\n        \"deletion\",\r\n        \"emphasis\",\r\n        \"generic\",\r\n        \"insertion\",\r\n        \"paragraph\",\r\n        \"presentation\",\r\n        \"strong\",\r\n        \"subscript\",\r\n        \"superscript\"\r\n    ]);\r\n}\r\n/**\r\n *\r\n * @param node -\r\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\r\n * @returns {boolean} -\r\n */\r\nfunction isHidden(node, options) {\r\n    if (!util_1.isElement(node)) {\r\n        return false;\r\n    }\r\n    if (node.hasAttribute(\"hidden\") ||\r\n        node.getAttribute(\"aria-hidden\") === \"true\") {\r\n        return true;\r\n    }\r\n    const style = createGetComputedStyle(node, options)(node);\r\n    return (style.getPropertyValue(\"display\") === \"none\" ||\r\n        style.getPropertyValue(\"visibility\") === \"hidden\");\r\n}\r\n/**\r\n *\r\n * @param {Node} node -\r\n * @param {string} attributeName -\r\n * @returns {Element[]} -\r\n */\r\nfunction idRefs(node, attributeName) {\r\n    if (util_1.isElement(node) && node.hasAttribute(attributeName)) {\r\n        // safe due to hasAttribute check\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        const ids = node.getAttribute(attributeName).split(\" \");\r\n        return ids\r\n            // safe since it can't be null for an Element\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            .map(id => node.ownerDocument.getElementById(id))\r\n            .filter((element) => element !== null\r\n        // TODO: why does this not narrow?\r\n        );\r\n    }\r\n    return [];\r\n}\r\n/**\r\n * All defined children. This include childNodes as well as owned (portaled) trees\r\n * via aria-owns\r\n * @param node\r\n */\r\nfunction queryChildNodes(node) {\r\n    return Array.from(node.childNodes).concat(idRefs(node, \"aria-owns\"));\r\n}\r\n/**\r\n * @param {Node} node -\r\n * @returns {boolean} - As defined in step 2E of https://w3c.github.io/accname/#mapping_additional_nd_te\r\n */\r\nfunction isControl(node) {\r\n    return (hasAnyConcreteRoles(node, [\"button\", \"combobox\", \"listbox\", \"textbox\"]) ||\r\n        hasAbstractRole(node, \"range\"));\r\n}\r\nfunction hasAbstractRole(node, role) {\r\n    if (!util_1.isElement(node)) {\r\n        return false;\r\n    }\r\n    switch (role) {\r\n        case \"range\":\r\n            return hasAnyConcreteRoles(node, [\r\n                \"meter\",\r\n                \"progressbar\",\r\n                \"scrollbar\",\r\n                \"slider\",\r\n                \"spinbutton\"\r\n            ]);\r\n        default:\r\n            throw new TypeError(`No knowledge about abstract role '${role}'. This is likely a bug :(`);\r\n    }\r\n}\r\nfunction hasAnyConcreteRoles(node, roles) {\r\n    if (util_1.isElement(node)) {\r\n        return roles.indexOf(getRole_1.default(node)) !== -1;\r\n    }\r\n    return false;\r\n}\r\n/**\r\n * element.querySelectorAll but also considers owned tree\r\n * @param element\r\n * @param selectors\r\n */\r\nfunction querySelectorAllSubtree(element, selectors) {\r\n    const elements = [];\r\n    for (const root of [element, ...idRefs(element, \"aria-owns\")]) {\r\n        elements.push(...Array.from(root.querySelectorAll(selectors)));\r\n    }\r\n    return elements;\r\n}\r\nfunction querySelectedOptions(listbox) {\r\n    if (util_1.isHTMLSelectElement(listbox)) {\r\n        // IE11 polyfill\r\n        return (listbox.selectedOptions || querySelectorAllSubtree(listbox, \"[selected]\"));\r\n    }\r\n    return querySelectorAllSubtree(listbox, '[aria-selected=\"true\"]');\r\n}\r\nfunction isMarkedPresentational(node) {\r\n    return hasAnyConcreteRoles(node, [\"none\", \"presentation\"]);\r\n}\r\n/**\r\n * TODO\r\n */\r\nfunction isNativeHostLanguageTextAlternativeElement(node) {\r\n    return false;\r\n}\r\n/**\r\n * https://w3c.github.io/aria/#namefromcontent\r\n */\r\nfunction allowsNameFromContent(node) {\r\n    return hasAnyConcreteRoles(node, [\r\n        \"button\",\r\n        \"cell\",\r\n        \"checkbox\",\r\n        \"columnheader\",\r\n        \"gridcell\",\r\n        \"heading\",\r\n        \"label\",\r\n        \"legend\",\r\n        \"link\",\r\n        \"menuitem\",\r\n        \"menuitemcheckbox\",\r\n        \"menuitemradio\",\r\n        \"option\",\r\n        \"radio\",\r\n        \"row\",\r\n        \"rowheader\",\r\n        \"switch\",\r\n        \"tab\",\r\n        \"tooltip\",\r\n        \"treeitem\"\r\n    ]);\r\n}\r\n/**\r\n * TODO\r\n */\r\nfunction isDescendantOfNativeHostLanguageTextAlternativeElement(node) {\r\n    return false;\r\n}\r\n/**\r\n * TODO\r\n */\r\nfunction computeTooltipAttributeValue(node) {\r\n    return null;\r\n}\r\nfunction getValueOfTextbox(element) {\r\n    if (util_1.isHTMLInputElement(element) || util_1.isHTMLTextAreaElement(element)) {\r\n        return element.value;\r\n    }\r\n    // https://github.com/eps1lon/dom-accessibility-api/issues/4\r\n    return element.textContent || \"\";\r\n}\r\nfunction getTextualContent(declaration) {\r\n    const content = declaration.getPropertyValue(\"content\");\r\n    if (/^[\"'].*[\"']$/.test(content)) {\r\n        return content.slice(1, -1);\r\n    }\r\n    return \"\";\r\n}\r\n/**\r\n * implements https://w3c.github.io/accname/#mapping_additional_nd_te\r\n * @param root\r\n * @param [options]\r\n * @parma [options.getComputedStyle] - mock window.getComputedStyle. Needs `content`, `display` and `visibility`\r\n */\r\nfunction computeAccessibleName(root, options = {}) {\r\n    const consultedNodes = new Set();\r\n    if (prohibitsNaming(root)) {\r\n        return \"\";\r\n    }\r\n    // 2F.i\r\n    function computeMiscTextAlternative(node, context) {\r\n        let accumulatedText = \"\";\r\n        if (util_1.isElement(node)) {\r\n            const pseudoBefore = createGetComputedStyle(node, options)(node, \"::before\");\r\n            const beforeContent = getTextualContent(pseudoBefore);\r\n            accumulatedText = `${beforeContent} ${accumulatedText}`;\r\n        }\r\n        for (const child of queryChildNodes(node)) {\r\n            const result = computeTextAlternative(child, {\r\n                isEmbeddedInLabel: context.isEmbeddedInLabel,\r\n                isReferenced: false,\r\n                recursion: true\r\n            });\r\n            // TODO: Unclear why display affects delimiter\r\n            const display = util_1.isElement(node) &&\r\n                createGetComputedStyle(node, options)(node).getPropertyValue(\"display\");\r\n            const separator = display !== \"inline\" ? \" \" : \"\";\r\n            accumulatedText += `${separator}${result}`;\r\n        }\r\n        if (util_1.isElement(node)) {\r\n            const pseudoAfter = createGetComputedStyle(node, options)(node, \":after\");\r\n            const afterContent = getTextualContent(pseudoAfter);\r\n            accumulatedText = `${accumulatedText} ${afterContent}`;\r\n        }\r\n        return accumulatedText;\r\n    }\r\n    /**\r\n     * TODO: placeholder\r\n     */\r\n    function computeAttributeTextAlternative(node) {\r\n        if (!util_1.isElement(node)) {\r\n            return null;\r\n        }\r\n        const titleAttribute = node.getAttributeNode(\"title\");\r\n        if (titleAttribute !== null && !consultedNodes.has(titleAttribute)) {\r\n            consultedNodes.add(titleAttribute);\r\n            return titleAttribute.value;\r\n        }\r\n        const altAttribute = node.getAttributeNode(\"alt\");\r\n        if (altAttribute !== null && !consultedNodes.has(altAttribute)) {\r\n            consultedNodes.add(altAttribute);\r\n            return altAttribute.value;\r\n        }\r\n        if (util_1.isHTMLInputElement(node) && node.type === \"button\") {\r\n            consultedNodes.add(node);\r\n            return node.getAttribute(\"value\") || \"\";\r\n        }\r\n        return null;\r\n    }\r\n    function computeElementTextAlternative(node) {\r\n        if (!util_1.isHTMLInputElement(node)) {\r\n            return null;\r\n        }\r\n        const input = node;\r\n        // https://w3c.github.io/html-aam/#input-type-text-input-type-password-input-type-search-input-type-tel-input-type-email-input-type-url-and-textarea-element-accessible-description-computation\r\n        if (input.type === \"submit\") {\r\n            return \"Submit\";\r\n        }\r\n        if (input.type === \"reset\") {\r\n            return \"Reset\";\r\n        }\r\n        const { labels } = input;\r\n        // IE11 does not implement labels, TODO: verify with caniuse instead of mdn\r\n        if (labels === null || labels === undefined || labels.length === 0) {\r\n            return null;\r\n        }\r\n        consultedNodes.add(input);\r\n        return Array.from(labels)\r\n            .map(element => {\r\n            return computeTextAlternative(element, {\r\n                isEmbeddedInLabel: true,\r\n                isReferenced: false,\r\n                recursion: true\r\n            });\r\n        })\r\n            .filter(label => {\r\n            return label.length > 0;\r\n        })\r\n            .join(\" \");\r\n    }\r\n    function computeTextAlternative(current, context) {\r\n        if (consultedNodes.has(current)) {\r\n            return \"\";\r\n        }\r\n        // special casing, cheating to make tests pass\r\n        // https://github.com/w3c/accname/issues/67\r\n        if (hasAnyConcreteRoles(current, [\"menu\"])) {\r\n            consultedNodes.add(current);\r\n            return \"\";\r\n        }\r\n        // 2A\r\n        if (isHidden(current, options) && !context.isReferenced) {\r\n            consultedNodes.add(current);\r\n            return \"\";\r\n        }\r\n        // 2B\r\n        const labelElements = idRefs(current, \"aria-labelledby\");\r\n        if (!context.isReferenced && labelElements.length > 0) {\r\n            return labelElements\r\n                .map(element => computeTextAlternative(element, {\r\n                isEmbeddedInLabel: context.isEmbeddedInLabel,\r\n                isReferenced: true,\r\n                // thais isn't recursion as specified, otherwise we would skip\r\n                // `aria-label` in\r\n                // <input id=\"myself\" aria-label=\"foo\" aria-labelledby=\"myself\"\r\n                recursion: false\r\n            }))\r\n                .join(\" \");\r\n        }\r\n        // 2C\r\n        // Changed from the spec in anticipation of https://github.com/w3c/accname/issues/64\r\n        // spec says we should only consider skipping if we have a non-empty label\r\n        const skipToStep2E = context.recursion && isControl(current);\r\n        if (!skipToStep2E) {\r\n            const ariaLabel = ((util_1.isElement(current) && current.getAttribute(\"aria-label\")) ||\r\n                \"\").trim();\r\n            if (ariaLabel !== \"\") {\r\n                consultedNodes.add(current);\r\n                return ariaLabel;\r\n            }\r\n            // 2D\r\n            if (!isMarkedPresentational(current)) {\r\n                const elementTextAlternative = computeElementTextAlternative(current);\r\n                if (elementTextAlternative !== null) {\r\n                    consultedNodes.add(current);\r\n                    return elementTextAlternative;\r\n                }\r\n                const attributeTextAlternative = computeAttributeTextAlternative(current);\r\n                if (attributeTextAlternative !== null) {\r\n                    consultedNodes.add(current);\r\n                    return attributeTextAlternative;\r\n                }\r\n            }\r\n        }\r\n        // 2E\r\n        if (skipToStep2E || context.isEmbeddedInLabel || context.isReferenced) {\r\n            if (hasAnyConcreteRoles(current, [\"combobox\", \"listbox\"])) {\r\n                consultedNodes.add(current);\r\n                const selectedOptions = querySelectedOptions(current);\r\n                if (selectedOptions.length === 0) {\r\n                    // defined per test `name_heading_combobox`\r\n                    return util_1.isHTMLInputElement(current) ? current.value : \"\";\r\n                }\r\n                return Array.from(selectedOptions)\r\n                    .map(selectedOption => {\r\n                    return computeTextAlternative(selectedOption, {\r\n                        isEmbeddedInLabel: context.isEmbeddedInLabel,\r\n                        isReferenced: false,\r\n                        recursion: true\r\n                    });\r\n                })\r\n                    .join(\" \");\r\n            }\r\n            if (hasAbstractRole(current, \"range\")) {\r\n                consultedNodes.add(current);\r\n                if (current.hasAttribute(\"aria-valuetext\")) {\r\n                    // safe due to hasAttribute guard\r\n                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                    return current.getAttribute(\"aria-valuetext\");\r\n                }\r\n                if (current.hasAttribute(\"aria-valuenow\")) {\r\n                    // safe due to hasAttribute guard\r\n                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                    return current.getAttribute(\"aria-valuenow\");\r\n                }\r\n                // Otherwise, use the value as specified by a host language attribute.\r\n                return current.getAttribute(\"value\") || \"\";\r\n            }\r\n            if (hasAnyConcreteRoles(current, [\"textbox\"])) {\r\n                consultedNodes.add(current);\r\n                return getValueOfTextbox(current);\r\n            }\r\n        }\r\n        // 2F: https://w3c.github.io/accname/#step2F\r\n        if (allowsNameFromContent(current) ||\r\n            (util_1.isElement(current) && context.isReferenced) ||\r\n            isNativeHostLanguageTextAlternativeElement(current) ||\r\n            isDescendantOfNativeHostLanguageTextAlternativeElement(current)) {\r\n            consultedNodes.add(current);\r\n            return computeMiscTextAlternative(current, {\r\n                isEmbeddedInLabel: context.isEmbeddedInLabel,\r\n                isReferenced: false\r\n            });\r\n        }\r\n        if (current.nodeType === current.TEXT_NODE) {\r\n            consultedNodes.add(current);\r\n            return current.textContent || \"\";\r\n        }\r\n        if (context.recursion) {\r\n            consultedNodes.add(current);\r\n            return computeMiscTextAlternative(current, {\r\n                isEmbeddedInLabel: context.isEmbeddedInLabel,\r\n                isReferenced: false\r\n            });\r\n        }\r\n        const tooltipAttributeValue = computeTooltipAttributeValue(current);\r\n        if (tooltipAttributeValue !== null) {\r\n            consultedNodes.add(current);\r\n            return tooltipAttributeValue;\r\n        }\r\n        // TODO should this be reachable?\r\n        consultedNodes.add(current);\r\n        return \"\";\r\n    }\r\n    return asFlatString(computeTextAlternative(root, {\r\n        isEmbeddedInLabel: false,\r\n        isReferenced: false,\r\n        recursion: false\r\n    }));\r\n}\r\nexports.computeAccessibleName = computeAccessibleName;\r\n//# sourceMappingURL=accessible-name.js.map"]},"metadata":{},"sourceType":"script"}